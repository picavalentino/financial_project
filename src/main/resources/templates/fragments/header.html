<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org" xmlns:sec="www.thymeleaf.org/extras/spring-security">

<!-- header라는 이름으로 선언-->
<div th:fragment="header">
    <div class="navbar shadow-sm">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <!-- 로고 -->
                <div class="logo-container">
                    <a th:href="@{/main}" class="navbar-brand d-flex align-items-center">
                        <img src="/images/common/logo.png" alt="GS Bank Logo" class="logo">
                    </a>
                </div>

                <!-- 북마크 -->
                <div class="bookmark-container d-flex align-items-center" id="bookmark-container">
                    <div class="bookmark-item d-flex align-items-center">
                        <a href="#" class="d-flex align-items-center">
                            <img src="/images/common/pin_ok_white.png" alt="북마크" class="bookmark-icon">
                            <span>고객확인</span>
                        </a>
                        <a href="#" class="ml-auto">
                            <img src="/images/common/close.png" alt="삭제" class="img-close">
                        </a>
                    </div>
                </div>
            </div>

            <!-- 로그인 / 로그아웃 -->
            <div class="d-flex log">
                <a th:href="@{/mypage}" class="btn">MyPage</a>
                <button class="btn" id="btn-logout">Logout</button>
            </div>

            <!-- 토글 버튼 (헤더 위에 고정시키기) -->
            <button class="navbar-toggler d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu"
                    aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>

    </div>



    <!-- 토글로 표시될 사이드바 -->
    <div class="collapse collapse-top" id="sidebarMenu">
        <div class="p-3 shadow">
            <!-- 사이드바 내용 -->
            <div class="sidebar-toggle">
                <!-- 사이드바 메뉴 -->
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="collapse" data-bs-target="#customerManagement" aria-expanded="false"
                                    aria-controls="customerManagement">
                                고객관리
                            </button>
                            <div class="collapse" id="customerManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/customer/list}" class="nav-link">고객 목록</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton2"
                                    data-bs-toggle="collapse" data-bs-target="#productManagement" aria-expanded="false"
                                    aria-controls="productManagement">
                                상품 관리
                            </button>
                            <div class="collapse" id="productManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/product/list}" class="nav-link">상품 목록 조회</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/product/insert}" class="nav-link">신규 상품 등록</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/product/sales}" class="nav-link">매출 조회</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton3"
                                    data-bs-toggle="collapse" data-bs-target="#eventManagement" aria-expanded="false"
                                    aria-controls="eventManagement">
                                활동 관리
                            </button>
                            <div class="collapse" id="eventManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/schedule/personal}" class="nav-link">개인 일정 관리</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/schedule/customer}" class="nav-link">고객 이벤트 관리</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton4"
                                    data-bs-toggle="collapse" data-bs-target="#promotionManagement"
                                    aria-expanded="false" aria-controls="promotionManagement">
                                프로모션 관리
                            </button>
                            <div class="collapse" id="promotionManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/promotion/list}" class="nav-link">상품 설계 조회</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/promotion/cal}" class="nav-link">금융 계산기</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton6"
                                    data-bs-toggle="collapse" data-bs-target="#employeeManagement" aria-expanded="false"
                                    aria-controls="employeeManagement">
                                직원 관리
                            </button>
                            <div class="collapse" id="employeeManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/management/list}" class="nav-link">직원 목록</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/management/insert}" class="nav-link">직원 등록</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/management/employees}" class="nav-link">직원 정보 관리</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton5"
                                    data-bs-toggle="collapse" data-bs-target="#boardManagement" aria-expanded="false"
                                    aria-controls="boardManagement">
                                게시판
                            </button>
                            <div class="collapse" id="boardManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/inquire/list}" class="nav-link">게시글 목록</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/inquire/insert}" class="nav-link">게시글 등록</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton7"
                                    data-bs-toggle="collapse" data-bs-target="#systemManagement" aria-expanded="false"
                                    aria-controls="systemManagement">
                                시스템 관리
                            </button>
                            <div class="collapse" id="systemManagement">
                                <ul class="list-unstyled">
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/system/inquire}" class="nav-link">게시판 관리</a>
                                    </li>
                                    <li class="d-flex justify-content-between align-items-center">
                                        <a th:href="@{/system/auth}" class="nav-link">권한 관리</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        $(window).on('resize', function () {
            // 화면의 너비가 768px 이상이면
            if ($(window).width() >= 768) {
                const $collapseElement = $('#sidebarMenu');

                // Bootstrap Collapse 인스턴스 가져오기
                const bsCollapse = bootstrap.Collapse.getInstance($collapseElement[0]);

                if (bsCollapse) {
                    bsCollapse.hide(); // collapse를 닫음
                }
            }
        });

        // 북마크 목록 로드
        function loadBookmarks() {
            fetch('/bookmark/bmlist')
                .then(response => response.json())
                .then(data => {
                    console.log("받은 데이터:", data);
                    const container = document.getElementById('bookmark-container');
                    container.innerHTML = ''; // 기존 내용을 초기화

                    data.slice(0, 7).forEach(bookmark => {
                        // 북마크 아이템 생성
                        const item = document.createElement('div');
                        item.className = 'bookmark-item d-flex align-items-center';

                        // 링크 생성
                        const link = document.createElement('a');
                        link.href = bookmark.menu_url;
                        link.className = 'd-flex align-items-center';
                        link.innerHTML = `
                            <img src="/images/common/pin_ok_white.png" alt="북마크" class="bookmark-icon">
                            <span>${bookmark.menu_view_name}</span>
                        `;

                        // 닫기 버튼 생성
                        const closeBtn = document.createElement('a');
                        closeBtn.href = '#';
                        closeBtn.className = 'ml-auto';
                        closeBtn.innerHTML = `<img src="/images/common/close.png" alt="삭제" class="img-close">`;

                        // 닫기 버튼 클릭 이벤트 추가
                        closeBtn.addEventListener('click', function (e) {
                            e.preventDefault();
                            deleteBookmark(bookmark.menu_id, item);
                        });

                        // 아이템 구성
                        item.appendChild(link);
                        item.appendChild(closeBtn);
                        container.appendChild(item);
                    });
                });
        }

        // 북마크 삭제
        function deleteBookmark(menuId) {
            const csrfToken = $('meta[name="_csrf"]').attr('content');
            const csrfHeader = $('meta[name="_csrf_header"]').attr('content');
            fetch(`/bookmark/delete?menuId=${menuId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    [csrfHeader]: csrfToken, // CSRF 토큰 추가
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert('북마크가 삭제되었습니다.');
                        window.location.reload();
                    } else {
                        alert('북마크 삭제 실패');
                    }
                });
        }

        // 페이지 로드 시 북마크 목록 로드
        document.addEventListener('DOMContentLoaded', loadBookmarks);

        // 로그아웃
        $("#btn-logout").on("click", function () {
            try {
                const response = $.ajax({
                    url: '/logout',
                    type: 'POST',
                });
                if (response) {
                    alert("로그아웃이 완료되었습니다.");
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error("로그아웃 실패:", error);
                alert("로그아웃 중 문제가 발생했습니다.");
            }
        })
    </script>

</div>