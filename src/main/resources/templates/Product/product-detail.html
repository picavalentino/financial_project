<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org" xmlns:layout="www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<!--security 적용 후 아래 코드로 변경해주세요-->
<!--<html xmlns:th="www.thymeleaf.org" xmlns:layout="www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}" xmlns:sec="www.thymeleaf.org/extras/spring-security">-->

<meta charset="UTF-8">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/product/common.css">
    <link rel="stylesheet" href="/css/product/product-detail.css">
    <link rel="stylesheet" href="/css/buttons/button.css">
</head>

<title>GS Bank</title>
<!-- 전체 적용될 CSS -->
<th:block layout:fragment="css"></th:block>
<!-- 전체 적용될 스크립트 -->
<th:block layout:fragment="script"></th:block>

<!-- 우리가 작업할 공간 -->
<body>
<div layout:fragment="content" class="content">
        <div class="sub_content">
            <div class="location">
                <a th:href="@{/main}"><i class="bi bi-house-door-fill"></i> Home</a>
                <a th:href="@{/product/list}"> / 상품관리</a>
                <p> / 상품 상세보기</p>
            </div>
            <div class="product">
                <h1 class="title">상품 상세보기</h1>
                <div class="info-table">
                    <form th:action="@{/product/update/}" method="post" class="product-info">
                        <table class="table-product-form">
                            <tbody>
                            <tr>
                                <th><label>상품명</label></th>
                                <td><input th:value="${dto.prodNm}" type="text" readonly></td>
                            </tr>
                            <tr>
                                <th><label>상품코드</label></th>
                                <td><input th:value="${dto.prodCd}" type="text" readonly></td>
                            </tr>
                            <tr>
                                <th><label>상품유형</label></th>
                                <td><input th:value="${dto.prodTyCd}" type="text" readonly></td>
                            </tr>
                            <tr>
                                <th><label>가입대상</label></th>
                                <td><input th:value="${dto.prodSbstgTyCd}" type="text" readonly></td>
                            </tr>
                            <tr>
                                <th><label>가입금액</label></th>
                                <td>
                                    <div class="inp_wrap">
                                            <input th:value="${dto.prodInstlAmtMin} + ' (최소)'" type="text" readonly>
                                            <span>~</span>
                                            <input th:value="${dto.prodInstlAmtMax} + ' (최대)'" type="text" readonly>
                                            <span>원</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th><label>납입주기</label></th>
                                <td><input th:value="${dto.prodPayTyCd}" type="text" readonly></td>
                            </tr>
                            <tr>
                                <th><label>적용이율</label></th>
                                <td>
                                    <div class="inp_wrap">
                                        <input th:value="${dto.prodAirMin}" type="text" placeholder="최소">
                                        <span>~</span>
                                        <input th:value="${dto.prodAirMax}" type="text" placeholder="최대">
                                        <span>%</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th><label>적용기간</label></th>
                                <td>
                                    <div class="inp_wrap">
                                        <input th:value="${dto.prodAirBgnYmd}" type="date" required>
                                        <span>~</span>
                                        <input th:value="${dto.prodAirEndYmd}" type="date" required>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th><label>이자과세구분</label></th>
                                <td><input th:value="${dto.prodIntTaxTyCd}" type="text" readonly></td>
                            </tr>
                            <tr>
                                <th><label>판매상태</label></th>
                                <td><input th:value="${dto.prodCurrStcd}" type="text"></td>
                            </tr>
                            <tr>
                                <th><label>판매기간</label></th>
                                <td>
                                    <div class="inp_wrap">
                                        <input th:value="${dto.prodNtslBgnYmd}" type="date" required>
                                        <span>~</span>
                                        <input th:value="${dto.prodNtslEndYmd}" type="date" required>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                    <div class="air-info">
                        <label>이율변동내역</label>
                        <textarea readonly></textarea>
                    </div>
                </div>
            </div>
            <div class="button-wrap">
                <button class="btn btn-register">
                    <div class="icon"><i class="icon bi bi-plus-circle-fill"></i></div> 수정
                </button>
                <button class="btn btn-delete">
                    <div class="icon"><i class="icon bi bi-trash-fill"></i></div> 삭제
                </button>
                <button class="btn btn-list">
                    <div class="icon"><i class="icon bi bi-list"></i></div> 목록
                </button>
            </div>
        </div>

    <script th:inline="javascript">
        $(document).ready(function () {
            // 수정 버튼 클릭
            $(".btn-register").on("click", function (e) {
                e.preventDefault(); // 기본 동작 방지
                const formData = $("form.product-info").serialize(); // 폼 데이터 직렬화
                const updateUrl = "/product/update"; // 수정 요청 URL

                $.ajax({
                    url: updateUrl,
                    type: "POST",
                    data: formData,
                    success: function (response) {
                        alert("수정되었습니다.");
                        // 성공 시 원하는 동작 추가 (예: 상세 페이지 새로고침)
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        console.error("수정 실패: ", error);
                        alert("수정에 실패했습니다.");
                    },
                });
            });

            // 삭제 버튼 클릭
            $(".btn-delete").on("click", function (e) {
                e.preventDefault(); // 기본 동작 방지
                if (!confirm("정말 삭제하시겠습니까?")) {
                    return; // 사용자가 취소하면 중단
                }

                const deleteUrl = "/product/delete"; // 삭제 요청 URL
                const productId = $("input[name='prodCd']").val(); // 상품코드 또는 ID 가져오기

                $.ajax({
                    url: deleteUrl + "/" + productId,
                    type: "DELETE",
                    success: function (response) {
                        alert("삭제되었습니다.");
                        // 성공 시 목록 페이지로 이동
                        window.location.href = "/product/list";
                    },
                    error: function (xhr, status, error) {
                        console.error("삭제 실패: ", error);
                        alert("삭제에 실패했습니다.");
                    },
                });
            });

            // 목록 버튼 클릭
            $(".btn-list").on("click", function (e) {
                e.preventDefault(); // 기본 동작 방지
                window.location.href = "/product/list"; // 목록 페이지로 이동
            });
        });
    </script>


</div>
</body>
</html>