<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org" xmlns:layout="www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지</title>
    <link rel="stylesheet" th:href="@{/css/mypage/mypage.css}">
</head>

<body>
<div layout:fragment="content" class="content">
    <h1> 나의 정보</h1>
    <div class="content1">
        <div class="mypage_right">
            <div id="myprofile_mid">
                <img id="profile_img" src="/css/mypage/img/mypage_default_profile.jpg">
                <label for="file" class="custom-file-upload" disabled>파일 선택</label>
                <input type="file" id="file">
                <button id="pw_edit"> 비밀번호 변경하기</button>
            </div>
            <div class="input_box">
                <div id="myprofile_left">
                    <p>사원번호 <br> <input type="text" id="user_id" disabled></p>
                    <p>입사일 <br> <input type="text" id="user_incmp_ymd" disabled></p>
                    <p>부서 <br> <input type="text" id="user_dept_cd_code_cl" disabled></p>
                    <p>직무 <br> <input type="text" id="user_jbps_ty_cd_code_cl" disabled></p>
                </div>
                <div id="myprofile_right">
                    <p>이름 <br> <input type="text" id="user_name" disabled></p>
                    <div class="phone">
                        <p>휴대전화 <br>
                            <input type="text" id="phone_input1" disabled> -
                            <input type="text" id="phone_input2" disabled> -
                            <input type="text" id="phone_input3" disabled>
                            <button>인증</button>
                        </p>
                        <h5 id="msg">인증이 완료 되었습니다</h5>
                    </div>

                    <p>E-Mail <br> <input type="text" id="user_email" disabled></p>

                    <div class="buttons">
                        <button id="editButton">수정하기</button>
                        <button id="adminButton">등록하기</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="mypage_left">
            <div class="mycustomer">
                <div id="mycustomer_title">
                    <p> 나의 고객 정보 : </p>
                    <button type="text"> 더보기</button>
                </div>

                <table id="mycustomer_table">
                    <thead>
                    <th>고객 이름</th>
                    <th>가입 상품</th>
                    <th>이메일</th>
                    </thead>
                    <tbody id="customer_data"></tbody>
                </table>
            </div>

            <div class="myboard">
                <div id="myboard_title">
                    <p> 내 작성글 : </p>
                    <button type="text"> 더보기</button>
                </div>

                <table id="myboard_table">
                    <thead>
                    <th>제목</th>
                    <th>사원번호</th>
                    <th>작성일</th>
                    </thead>
                    <tbody id="board_data"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {
      const userId = "20130515004"; // 사원번호 (테스트 데이터)
      const apiUrl = `/mypage/${userId}`; // API 엔드포인트

      // 데이터를 가져와 페이지에 렌더링
      async function fetchAndRenderData() {
          try {
              const response = await fetch(apiUrl);
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              const data = await response.json();

              // 기본 정보 렌더링
              document.getElementById("user_id").value = data.user_id || "";
              document.getElementById("user_incmp_ymd").value = data.user_incmp_ymd || "";
              document.getElementById("user_dept_cd_code_cl").value = data.user_dept_cd_code_cl || "";
              document.getElementById("user_jbps_ty_cd_code_cl").value = data.user_jbps_ty_cd_code_cl || "";
              document.getElementById("user_name").value = data.user_name || "";

              const phone = data.user_telno || "";
              const phoneParts = phone.match(/(\d{3})(\d{4})(\d{4})/);
              if (phoneParts) {
                  document.getElementById("phone_input1").value = phoneParts[1];
                  document.getElementById("phone_input2").value = phoneParts[2];
                  document.getElementById("phone_input3").value = phoneParts[3];
              } else {
                  document.getElementById("phone_input1").value = "";
                  document.getElementById("phone_input2").value = "";
                  document.getElementById("phone_input3").value = "";
              }

              document.getElementById("user_email").value = data.user_email || "";

              // 고객 정보 렌더링
              const customerTable = document.getElementById("customer_data");
              if (data.customers && data.customers.length > 0) {
                  customerTable.innerHTML = data.customers
                      .map(customer => `
                          <tr>
                              <td><a href="#">${customer.cust_nm}</a></td>
                              <td>${customer.dsgn_ds_ty_cd_code_cl}</td>
                              <td>${customer.cust_email}</td>
                          </tr>
                      `)
                      .join("");
              } else {
                  customerTable.innerHTML = `<tr><td colspan="3">고객 정보가 없습니다.</td></tr>`;
              }

              // 작성글 렌더링
              const boardTable = document.getElementById("board_data");
              if (data.boards && data.boards.length > 0) {
                  boardTable.innerHTML = data.boards
                      .map(board => `
                          <tr>
                              <td><a href="#">${board.inq_title}</a></td>
                              <td>${board.user_id}</td>
                              <td>${board.inq_create_at}</td>
                          </tr>
                      `)
                      .join("");
              } else {
                  boardTable.innerHTML = `<tr><td colspan="3">작성글이 없습니다.</td></tr>`;
              }
          } catch (error) {
              console.error("데이터 가져오기 실패:", error);
          }
      }

      // 데이터 가져오기 호출
      fetchAndRenderData();
  });

    </script>

</div>


</body>


</html>